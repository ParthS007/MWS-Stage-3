"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"openDatabase",value:function(){return navigator.serviceWorker?idb.open("restaurants",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"})}):Promise.resolve()}},{key:"populateDatabase",value:function(r){return i.openDatabase().then(function(e){if(e){var t=e.transaction("restaurants","readwrite"),n=t.objectStore("restaurants");return r.forEach(function(e){n.put(e)}),t.complete}})}},{key:"getIdbRestaurants",value:function(){return i.openDatabase().then(function(e){if(e)return e.transaction("restaurants").objectStore("restaurants").getAll()})}},{key:"fetchRestaurants",value:function(t){return i.getIdbRestaurants().then(function(e){return e.length?e:fetch(i.DATABASE_URL).then(function(e){return e.json()}).then(function(e){return i.populateDatabase(e),e})}).then(function(e){t(null,e)})}},{key:"fetchRestaurantById",value:function(r,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.find(function(e){return e.id==r});n?u(null,n):u("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});u(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});u(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,u,a){i.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=u&&(n=n.filter(function(e){return e.neighborhood==u})),a(null,n)}})}},{key:"fetchNeighborhoods",value:function(u){i.fetchRestaurants(function(e,n){if(e)u(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});u(null,t)}})}},{key:"fetchCuisines",value:function(u){i.fetchRestaurants(function(e,n){if(e)u(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});u(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e,t){return 10==e.id&&(e.photograph=10),"dist/img/"+e.photograph+"-"+t+".webp"}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:i.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"addReview",value:function(e){return fetch(i.REVIEWS_URL,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},{key:"fetchReviews",value:function(n){fetch(i.REVIEWS_URL).then(function(e){return e.json()}).then(function(e){var t=e.filter(function(e){return e.restaurant_id==n});t?fillReviewsHTML(t):fillReviewsHTML(null)})}},{key:"submitFavRestaurant",value:function(e,t){fetch(""+i.DATABASE_URL+e+"/?is_favorite="+t,{method:"put"})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants/"}},{key:"REVIEWS_URL",get:function(){return"http://localhost:1337/reviews/"}}]),i}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsImlkYiIsInRoZW4iLCJ1cGdyYWRlRGIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlc3RhdXJhbnRzIiwiY29tcGxldGUiLCJkYiIsInR4IiwidHJhbnNhY3Rpb24iLCJzdG9yZSIsIm9iamVjdFN0b3JlIiwiZm9yRWFjaCIsInJlc3RhdXJhbnQiLCJvcGVuRGF0YWJhc2UiLCJnZXRBbGwiLCJjYWxsYmFjayIsImZldGNoIiwiREFUQUJBU0VfVVJMIiwicmVzcG9uc2UiLCJqc29uIiwicG9wdWxhdGVEYXRhYmFzZSIsImZldGNoUmVzdGF1cmFudHMiLCJlcnJvciIsImZpbmQiLCJyIiwiaWQiLCJjdWlzaW5lIiwiZmlsdGVyIiwicmVzdWx0cyIsIm5laWdoYm9yaG9vZCIsImN1aXNpbmVfdHlwZSIsIm1hcCIsInYiLCJpIiwibmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInNpemUiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJyZXZpZXciLCJ1bmlxdWVDdWlzaW5lcyIsIm1ldGhvZCIsImhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIlJFVklFV1NfVVJMIiwicmV2aWV3cyIsInJldmlld3NCeUlkIiwicmVzdGF1cmFudF9pZCIsImZpbGxSZXZpZXdzSFRNTCIsImZsYWciXSwibWFwcGluZ3MiOiJpWUFLTUEsMEhBK0JILE9BQUFDLFVBQUFDLGNBR0NDLElBQU9ILEtBQUFBLGNBQUEsRUFBd0JJLFNBQUtDLEdBQzFCQSxFQUFBQyxrQkFBQSxjQUFBLENBUE5DLFFBQVMsU0FMSkMsUUFBUUMsbURB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QVcwQixXQUEvQixJQUE2Q0QsRUFBN0MsdURBekIwQnpCLEVBQUNVLEdBTXZCLE9BTFMsSUFBQWlCLE9BQUFDLEtBQUFDLE9BQUEsQ0FDVDFCLFNBQUFBLEVBQWdCMkIsT0FDakJDLE1BRkQvQixFQUVPZ0MsS0FDTEMsSUFBQW5ELEVBQUFvRCxpQkFBQWxDLEdBQ0FtQixJQUFBQSxFQUFpQ2dCLFVBQUFSLE9BQVVuQyxLQUFBQSxVQUFlMEIseUNBRTFEa0IsR0FDQWpDLE9BQUFBLE1BQUFBLEVBQWVrQyxZQUFmLENBQ0RDLE9BQUEsT0FDRkMsUUFWRCxDQVdEQyxlQUFBLG9CQUVEQyxLQUFBQyxLQUFBQyxVQUFBUCwwQ0F1Q29CdkIsR0FDbEJULE1BQU10QixFQUFTOEQsYUFDUjFELEtBQUssU0FBU29CLEdBckNyQixPQUFBQSxFQUFBQyxTQUNEckIsS0FBQSxTQUFBMkQsR0F1Q08sSUFBTUMsRUFBY0QsRUFBUTlCLE9BQU8sU0FBQUgsR0FBQSxPQUFLQSxFQUFFbUMsZUFBaUJsQyxJQXJDbkVpQyxFQXVDVUUsZ0JBQWdCRixHQUVoQkUsZ0JBQWdCLG9EQXJDeEJuQyxFQUF3QmIsR0FDeEJJLE1BQUFBLEdBQUF0QixFQUFBdUIsYUFBb0JMLEVBQXBCLGlCQUFBaUQsRUFBQSxDQUFBWCxPQUFBLDZDQTVMQSxNQUFBLHlFQUtFLE1BQUEiLCJmaWxlIjoiZGJoZWxwZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5cclxuXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuXHJcbiAgLypzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSA4MDgwIC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L2RhdGEvcmVzdGF1cmFudHMuanNvbmA7XHJcbiAgfSovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHMvYDtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBnZXQgUkVWSUVXU19VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmV2aWV3cy9gO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIG9wZW5EYXRhYmFzZSgpIHtcclxuICAgIGlmKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcil7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzJywgMSwgZnVuY3Rpb24gKHVwZ3JhZGVEYikge1xyXG4gICAgICB2YXIgc3RvcmUgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xyXG4gICAgICAgIGtleVBhdGg6ICdpZCdcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBwb3B1bGF0ZURhdGFiYXNlKHJlc3RhdXJhbnRzKXtcclxuICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uKGRiKXtcclxuICAgICAgaWYoIWRiKSByZXR1cm47XHJcblxyXG4gICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgIHZhciBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xyXG4gICAgICByZXN0YXVyYW50cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICBzdG9yZS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBnZXRJZGJSZXN0YXVyYW50cygpe1xyXG4gICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24oZGIpe1xyXG4gICAgICBpZighZGIpIHJldHVybjtcclxuXHJcbiAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycpO1xyXG4gICAgICB2YXIgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcclxuICAgICAgcmV0dXJuIHN0b3JlLmdldEFsbCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcclxuICAgIC8qbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgeGhyLm9wZW4oJ0dFVCcsIERCSGVscGVyLkRBVEFCQVNFX1VSTCk7XHJcbiAgICB4aHIub25sb2FkID0gKCkgPT4ge1xyXG4gICAgICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7IC8vIEdvdCBhIHN1Y2Nlc3MgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIhXHJcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBqc29uLnJlc3RhdXJhbnRzO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgfSBlbHNlIHsgLy8gT29wcyEuIEdvdCBhbiBlcnJvciBmcm9tIHNlcnZlci5cclxuICAgICAgICBjb25zdCBlcnJvciA9IChgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3hoci5zdGF0dXN9YCk7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgeGhyLnNlbmQoKTsqL1xyXG4gICAgcmV0dXJuIERCSGVscGVyLmdldElkYlJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKHJlc3RhdXJhbnRzLmxlbmd0aCkge1xyXG4gICAgICAgIHJldHVybiByZXN0YXVyYW50cztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKVxyXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgIH0pLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgICAgICBEQkhlbHBlci5wb3B1bGF0ZURhdGFiYXNlKHJlc3RhdXJhbnRzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KS50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNpemUpIHtcclxuICAgIGlmKHJlc3RhdXJhbnQuaWQgPT0gMTApIHJlc3RhdXJhbnQucGhvdG9ncmFwaCA9IDEwOyBcclxuICAgIHJldHVybiAoYGRpc3QvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS0ke3NpemV9LndlYnBgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgbWFwOiBtYXAsXHJcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1B9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBhZGRSZXZpZXcocmV2aWV3KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goREJIZWxwZXIuUkVWSUVXU19VUkwsIHtcclxuICAgICAgbWV0aG9kOiAncG9zdCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJyA6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXcpXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBmZXRjaFJldmlld3MoaWQpe1xyXG4gICAgZmV0Y2goREJIZWxwZXIuUkVWSUVXU19VUkwpXHJcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgfSkudGhlbihyZXZpZXdzPT4ge1xyXG4gICAgICAgICAgY29uc3QgcmV2aWV3c0J5SWQgPSByZXZpZXdzLmZpbHRlcihyID0+IHIucmVzdGF1cmFudF9pZCA9PSBpZCk7XHJcbiAgICAgICAgICBpZihyZXZpZXdzQnlJZClcclxuICAgICAgICAgICAgZmlsbFJldmlld3NIVE1MKHJldmlld3NCeUlkKTtcclxuICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgZmlsbFJldmlld3NIVE1MKG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHN1Ym1pdEZhdlJlc3RhdXJhbnQoaWQsIGZsYWcpe1xyXG4gICAgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfSR7aWR9Lz9pc19mYXZvcml0ZT0ke2ZsYWd9YCwge21ldGhvZDogJ3B1dCd9KVxyXG4gIH1cclxuXHJcbn1cclxuIl19
